from pwn import xor
import os

# Get first 32 bytes of encrypetd private key
enc = open('encrypted/id_rsa_enc.raw', 'rb').read(32)
print('First 32 bytes of encrypted key:')
print(enc)

# first 32 bytes of private key (from wikipedia)
priv_header = b'\x2D\x2D\x2D\x2D\x2D\x42\x45\x47\x49\x4E\x20\x4F\x50\x45\x4E\x53\x53\x48\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4B\x45\x59\x2D\x2D'

# Uses the fact that XOR is it's own inverse (if A xor B = C, then A xor C = B)
key = xor(enc, priv_header)
print('Decrypted key:')
print(key)

os.makedirs('decrypted', exist_ok=True)

# Decrypt Resoucres ZIP
full_data = open('encrypted/resources_zip_enc.raw', 'rb').read()
decrypted = xor(full_data, key)
with open('decrypted/resources.zip', 'wb') as f:
    f.write(decrypted)

# Decrypt PDF w/ password
full_data = open('encrypted/welcome_aboard_pdf_enc.raw', 'rb').read()
decrypted = xor(full_data, key)
with open('decrypted/Welcome Aboard.pdf', 'wb') as f:
    f.write(decrypted)